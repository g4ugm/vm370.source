VDE      TITLE 'DMKVDE     (CP)        VM/370 - RELEASE 6'              00001000
         ISEQ  73,80          VALIDATE SEQUENCING OF SYSIN     @V407466 00002000
*.                                                                      00003000
* MODULE NAME -                                                         00004000
*                                                                       00005000
*        DMKVDE                                                         00006000
*                                                                       00007000
* FUNCTION -                                                            00008000
*        SUBROUTINE TO VERIFY DEVICE EXISTENCE FOR DEVICE WHICH         00009000
*        IS BEING ATTACHED.                                             00010000
*.                                                                      00011000
         EJECT                                                          00012000
         PUNCH 'SPB' TELL LOADER TO START AT NEXT PAGE BOUNDRY         00013000
DMKVDE   START                                                          00014000
         SPACE                                                          00015000
         DC    CL8'DMKVDE'    MODULE IDENTIFICATION            @V407466 00016000
         SPACE                                                          00017000
         USING PSA,R0                                          @V407466 00018000
         USING SAVEAREA,R13                                    @V407466 00019000
         EXTRN DMKIOSQR                                        @V407466 00020000
         EXTRN DMKSCNRU                                        @V407466 00021000
         SPACE                                                          00022000
*                                                                       00023000
* ATTRIBUTES -                                                          00024000
*                                                                       00025000
*        REENTRANT, PAGEABLE, CALLED VIA SVC                            00026000
*                                                                       00027000
* ENTRY CONDITIONS -                                                    00028000
*                                                                       00029000
*        GPR  6 = VADDR FOR DEVICE BEING ATTACHED                       00030000
*        GPR  8 = ADDRESS OF RDEVBLOK                                   00031000
*        GPR 10 = ATTACHEE'S VMBLOK                                     00032000
*        GPR 11 = ATTACHER'S VMBLOK                                     00033000
*        GPR 12 = ADDRESS OF DMKVDEDC                                   00034000
*        GPR 13 = ADDRESS OF STANDARD SAVE AREA                         00035000
         SPACE                                                          00036000
*        PARM = 1 PASSED ON THE CALL MACRO INDICATES THAT               00037000
*        DEVICE IS DASD AND ALLOCATION DATA IS TO BE READ.              00038000
         SPACE                                                          00039000
*                                                                       00040000
* EXIT CONDITIONS -                                                     00041000
*                                                                       00042000
*                                                                       00043000
*        RETURN IS TO DMKVDA                                            00044000
*                                                                       00045000
*        GPR  2 = 0 IF LABEL/ALLOC. RECORD HAS BEEN READ                00046000
*        SUCCESSFULLY.                                                  00047000
*        GPR  2 = ERROR CODE IS LABEL/ALLOC READ UNSUCCESSFUL.          00048000
*                                                                       00049000
* CALLS TO OTHER ROUTINES -                                             00050000
*                                                                       00051000
*        DMKIOSQR                                                       00052000
*        DMKDSPCH                                                       00053000
*        DMKSCNRU                                                       00054000
*        DMKFREE                                                        00055000
*        DMKFRET                                                        00056000
*                                                                       00057000
* EXTERNAL REFERENCES -                                                 00058000
*                                                                       00059000
*        NONE                                                           00060000
*                                                                       00061000
* TABLES / WORK AREAS -                                                 00062000
*                                                                       00063000
*        VMBLOK                                                         00064000
*                                                                       00065000
* REGISTER USAGE -                                                      00066000
*                                                                       00067000
*        GPR  2 = RETURN CODE FOR DMKVDA                                00068000
*        GPR  3 = WORK                                                  00069000
*        GPR  4 = WORK                                                  00070000
*        GPR  5 = WORK                                                  00071000
*        GPR  6 = VADDR OF DEVICE BEING ATTACHED                        00072000
*        GPR  7 = WORK                                                  00073000
*        GPR  8 = ADDRESS OF RDEVBLOK                                   00074000
*        GPR 10 = ADDRESS OF VMBLOK FOR ATTACHED-TO USER                00075000
*        GPR 11 = ADDRESS OF CALLER'S OR USER'S VMBLOK                  00076000
*        GPR 12 = BASE REGISTER                                         00077000
*        GPR 13 = ADDRESS OF STANDARD SAVE AREA                         00078000
*                                                                       00079000
*                                                                       00080000
*                                                                       00081000
* OPERATION -                                                           00082000
*                                                                       00083000
*        DMKVDEDC - SUBROUTINE TO VERIFY DEVICE EXISTENCE.            * 00084000
*        SETS UP AN I/O TASK (TIO) TO SEE IF DEVICE EXISTS.           * 00085000
*        IF THE DEVICE DOES NOT EXIST, IT IS MARKED OFFLINE           * 00086000
*        AND THE APPROPRIATE RETURN CODE IS PLACED IN SAVER2          * 00087000
*        TO BE PASSED BACK TO DMKVDA.  A 'DOES NOT EXIST' MESSAGE     * 00088000
*        WILL BE ISSUED BY DMKVDA.                                    * 00089000
*                  -------------------------------                    * 00090000
*        IN ADDITION, FOR DASD DMKVDE                                 * 00091000
*        SETS UP AND EXECUTES AN I/O TASK TO READ THE DASD VOLUME     * 00092000
*        LABEL OF THE DEVICE BEING ATTACH'ED. IF SUCCESSFUL, THE      * 00093000
*        VOLUME SERIAL IS INSERTED INTO THE 'RDEVSER' FIELD OF THE    * 00094000
*        REAL DEVICE BLOCK. RETURN CODES ARE SET IN SAVER2 TO         * 00095000
*        INDICATE FAILURE OF THE READ.  IF A CP/370 OWNED VOLUME IS   * 00096000
*        ENCOUNTERED, A FLAG IS SET IN THE DMKVDA SAVE AREA.          * 00097000
*        IF DMKVDE HAS BEEN CALLED WITH PARM=1, MEANING ALLOCATION    * 00098000
*        DATA IS PRESENT, DMKVDE WILL READ THE ALLOCATION RECORD      * 00099000
*        INTO FREE STORAGE.                                           * 00100000
*---------------------------------------------------------------------* 00101000
*.                                                                      00102000
         COPY  OPTIONS                                         @VA08059 00102300
         COPY  LOCAL          OPTIONS                          @VA08059 00102700
         EJECT                                                          00103000
DMKVDEDC RELOC ATTACH         A REAL DEVICE OR CHANNEL TO      @V407466 00104000
*                             USER'S VM                                 00105000
         USING RDEVBLOK,R8    RDEVBLOK ADDRESSABILITY          @V407466 00106000
         SLR   R3,R3          CLEAR R3                         @V407466 00107000
         LA    R0,IOBSIZE     SIZE OF IOBLOK IN DWDS.          @V407466 00108000
         CLI   RDEVTYPC,CLASDASD DASD DEVICE                   @V407466 00109000
         BNE   RDLAIOB        NO, IOBLOK IS RIGHT SIZE         @V407466 00110000
         LA    R0,ALLOLEN+IOBSIZE SIZE FOR ALLOC DATA BLOCK    @V407466 00111000
         C     R2,F1          READING ALLOCATION DATA ?        @V407466 00112000
         BE    RDLAIOB        YES - ALL SET TO GO              @V407466 00113000
         LA    R0,VDELLEN     SMALLER IOBLOK FOR LABEL READ    @V407466 00114000
RDLAIOB  EQU   *              GET AN IOB + BUFFER FROM FREE STG@V407466 00115000
         CALL  DMKFREE                                         @V407466 00116000
         XC    0(IOBSIZE*8,R1),0(R1) CLEAR IOBLOK TO ZEROES    @V407466 00117000
         ST    R10,IOBMISC-IOBLOK(,R1) SAVE ATTACHEE'S VMBLOK  @V407466 00118000
         LR    R10,R1                                          @V407466 00119000
         USING IOBLOK,R10     STANDARD IOBLOK ADDRESSABILITY   @V407466 00120000
RDLCPEX1 OI    IOBSPEC,IOBTIO FLAG REQUEST FOR SPECIAL 'TIO'   @VA07221 00121100
         SPACE                                                          00122000
RDLCPEX  EQU   *              GET CPEXBLOK FOR REGISTERS       @V407466 00123000
         LA    R0,CPEXSIZE    GET A CPEXBLOK...                @V407466 00124000
         CALL  DMKFREE        ...TO USE AS A SAVE-AREA         @V407466 00125000
         USING CPEXBLOK,R1    ...ACROSS THE CALL TO 'IOS'      @V407466 00126000
         STM   R0,R15,CPEXR0  SAVE ALL CURRENT REGISTERS       @V407466 00127000
         ST    R1,IOBMISC2    SAVE THE CPEXBLOK HERE           @V407466 00128000
         DROP  R1                                              @V407466 00129000
         SPACE                                                          00130000
         ST    R11,IOBUSER    ATTACHER'S VMBLOK                @V407466 00131000
         LA    R1,RDLBIRA     INTERRUPT RETURN ADDRESS         @V407466 00132000
         ST    R1,IOBIRA      ...                              @V407466 00133000
         TM    IOBSPEC,IOBTIO SPECIAL 'TIO'                    @V407466 00134000
         BO    RDLIOSR        YES, TEST THE DEVICE NOW         @V407466 00135000
         LA    R4,VDELCCW-VDELOK(,R10) CCW START               @V407466 00136000
         ST    R4,IOBCAW      ...                              @V407466 00137000
         MVC   0(LABLSZ,R4),LABLCCW MOVE IN MODEL CCW'S        @V407466 00138000
         XC    VDELSNS-VDELOK(IOERSNSZ,R10),VDELSNS-VDELOK CLR @V407466 00139000
         C     R2,F1          READING ALLOCATION RECORD ?      @V407466 00140000
         BNE   RDLACCW        NO - RELOCATE CCW'S              @V407466 00141000
         MVC   VDELCNT-VDELOK(8,R10),ALLOCNT DIFF RECORD NO.   @V407466 00142000
         OI    52(R4),SKIP    PREVENT TRANSFER OF SENSE DATA   @V407466 00143000
         LA    R1,1024        ...ALSO LONGER RECORD            @V407466 00144000
         STH   R1,46(,R4)     ...INTO 'READ DATA' CCW          @V407466 00145000
RDLACCW  EQU   *                                               @V407466 00146000
         LR    R5,R4          ...START ADDRESS                 @V407466 00147000
         LA    R1,7           NUMBER TO BE RELOCATED           @V407466 00148000
RDLABL1  EQU   *              RELOCATE CCW ADDRESSES           @V407466 00149000
         L     R0,0(,R5)                                       @V407466 00150000
         ALR   R0,R4          ADD CCW BASE ADDRESS             @V407466 00151000
         ST    R0,0(,R5)                                       @V407466 00152000
         LA    R5,8(,R5)      NEXT CCW                         @V407466 00153000
         BCT   R1,RDLABL1     CONTINUE                         @V407466 00154000
         L     R1,IOBMISC2    GET CPEXBLOK ADDRESS             @V407466 00155000
         USING CPEXBLOK,R1    ADDRESSABILITY                   @V407466 00156000
         ST    R5,CPEXR5      PTR TO LAST CCW + 8              @V407466 00157000
         DROP  R1                                              @V407466 00158000
RDLIOSR  EQU   *              QUEUE IOBLOK FOR EXECUTION       @V407466 00159000
         MVI   IOBFLAG,IOBCP  CP-GENERATED I/O                 @V407466 00160000
         CALL  DMKIOSQR       R8 = RDEVBLOK, R10 = IOBLOK      @V407466 00161000
         GOTO  DMKDSPCH       WAIT FOR IT                      @V407466 00162000
         SPACE 4                                                        00163000
RDLBIRA  EQU   *              INTERRUPT RETURN POINT           @V407466 00164000
         USING *,R12                                           @V407466 00165000
         SL    R12,=A(RDLBIRA-DMKVDE) ADJUST ADDRESSABILITY    @V407466 00166000
         USING DMKVDE,R12                                      @V407466 00167000
         SPACE                                                          00168000
         L     R1,IOBMISC2    GET CPEXBLOK ADDRESS             @V407466 00169000
         USING CPEXBLOK,R1                                     @V407466 00170000
         LM    R0,R9,CPEXR0   RELOAD OUR REGISTERS             @V407466 00171000
         L     R13,CPEXR13    ...                              @V407466 00172000
         LA    R0,CPEXSIZE    RETURN TO FREE STORAGE           @V407466 00173000
         CALL  DMKFRET        ...                              @V407466 00174000
         DROP  R1                                              @V407466 00175000
         SPACE                                                          00176000
         SWITCH               CONTINUE ON THE I/O PROCESSOR    @V407508 00177000
         TM    IOBSPEC,IOBTIO WAS THIS A SPECIAL 'TIO' REQUEST?@V407466 00178000
         BO    CKREADY        YES - CHECK IF DASD DEV IS READY @V407466 00179000
         TM    IOBSTAT,IOBFATAL FATAL DISK ERROR ?             @V407466 00180000
         BZ    RDLABL2        NO - O.K.                        @V407466 00181000
DATMODER LA    R3,BADLABL2    LABEL READ FAILED                @V407466 00182000
         C     R2,F1          IF THIS IS ALLOC RECORD...       @V407466 00183000
         BE    RDLFRET        ... DON'T CLEAR THE SERIAL       @V407466 00184000
         LA    R3,BADLABL     READING REGL LABEL, NOT ALLOC    @V407466 00185000
CYLFAULT MVC   RDEVSER(6),BLANKS CLEAR VOLUME SERIAL           @V407466 00186000
         B     RDLFRET        GO RELEASE THE IOBLOK            @V407466 00187000
         SPACE                                                          00188000
CKREADY  NI    IOBSPEC,X'FF'-IOBTIO RESET TIO FLAG             @V407466 00189000
         TM    IOBSTAT,IOBCC3 IS DRIVE AVAILABLE?              @V407466 00190000
         BZ    VDECC0         YES, GO READ VOLUME LABEL IF DASD@V407466 00191000
         BO    VDECC3         NO, DEVICE DOES NOT EXIST        @V407466 00192000
* CC = 1, MAYBE UC                                                      00193000
         CLI   RDEVTYPC,CLASDASD DASD DEVICE TYPE              @V407466 00194000
         BNE   CKTAP          NO, SKIP CHECK FOR CC=1, UC      @V407466 00195000
         TM    IOBCSW+4,UC    UNIT CHECK                       @V407466 00196000
         BZ    RDLCPEX1       NO--GO RETRY THE TIO             @VA07221 00197100
         TM    RDEVFTR,FTRVIRT 3330V DEVICE?                   @V407466 00198000
         BZ    NOTREADY       NO, SKIP CHECK FOR CC=1, UC      @V407466 00199000
         TM    IOBSTAT,IOBCC1 CC = 1 - CYLINDER FAULT          @V407466 00200000
         BZ    NOTREADY       NO, SOMETHING ELSE WENT WRONG    @V407466 00201000
         TM    IOBCSW+4,UC    CC=1, UC - CYLINDER FAULT        @V407466 00202000
         BO    CYLFAULT       YES, ATTACH ANYWAY               @V407466 00203000
NOTREADY LA    R3,NOTREDY     FLAG DEVICE AS NOT READY         @V407466 00204000
         B     RDLFRET        GO TO EXIT                       @VA07700 00204500
         SPACE                                                          00205000
CKTAP    CLI   RDEVTYPC,CLASTAPE MIXED - CC=1,CSW STORED       @V407466 00206000
         BNE   VDECC0         NOT TAPE, ASSUME DEVICE THERE    @V407466 00207000
         L     R1,IOBIOER     CHECK TO SEE IF IOERBLOK         @V407466 00208000
         LTR   R1,R1          IS THERE ONE?                    @V407466 00209000
         BZ    RDLFRET        NO, RETURN TO CALLER             @V407466 00210000
         USING IOERBLOK,R1                                     @V407466 00211000
         TM    IOERDATA,X'40' INTERVENTION REQUIRED            @V407466 00212000
         BZ    RDLFRET        NO                               @V407466 00213000
         TM    IOERDATA+1,X'60' STATUS A & B ON                @V407466 00214000
         BNZ   RDLFRET        SOMETHING ON, DEVICE THERE       @V407466 00215000
         OI    IOBSTAT,IOBCC3 MAKE SURE BOTH BITS ARE ON       @V407466 00216000
VDECC3   LR    R1,R6          GET CCU FORM OF ADDR             @V407466 00217000
* PASSED FROM DMKVDA                                                    00218000
         LA    R6,1           NO. OF EXPOSURES TO VARY         @V407466 00219000
         CLI   RDEVTYPC,CLASDASD DASD DEVICE                   @V407466 00220000
         BNE   VARYOFF        NO                               @V407466 00221000
         CLI   RDEVTYPE,TYP2305 DRUM                           @V407466 00222000
         BNE   VARYOFF        NO                               @V407466 00223000
         LA    R6,8           NO. OF EXPOSURES FOR DRUM        @V407466 00224000
         LA    R1,7(,R1)      CONSTRUCT HIGHEST EXPOSURE ADDR  @V407466 00225000
VARYLOOP CALL  DMKSCNRU       GET BLOCKS                       @V407466 00226000
         BCTR  R1,0           ...                              @V407466 00227000
VARYOFF  OI    RDEVSTAT,RDEVDISA MARK DEVICE OFFLINE           @V407466 00228000
         BCT   R6,VARYLOOP    CONTINUE                         @V407466 00229000
         LA    R3,UNKNOWN     ISSUE MESSAGE                    @V407466 00230000
         B     RDLFRET        FRET BLOCKS FIRST                @V407466 00231000
         SPACE                                                          00232000
VDECC0   CLI   RDEVTYPC,CLASDASD DASD DEVICE                   @V407466 00233000
         BE    RDLCPEX        YES, GO READ LABEL               @V407466 00234000
         CLI   RDEVTYPC,CLASTERM TERMINAL DEVICE               @V407466 00235000
         BNE   RDLFRET        NO RELEASE BLOCKS                @V407466 00236000
         TM    RDEVTYPE,TYPBSC IS THIS BISYNC LINE             @V407466 00237000
         BZ    RDLFRET        NO                               @V407466 00238000
         NI    RDEVSTAT,X'FF'-RDEVNRDY CLEAR NOT READY FLAG    @V407466 00239000
         B     RDLFRET        RELEASE STORAGE                  @V407466 00240000
         SPACE                                                          00241000
RDLABL2  EQU   *              CHECK LABEL FORMAT               @V407466 00242000
         TM    RDEVFTR,FTRVIRT 3330V DEVICE ADDRESS            @V407466 00243000
         BZ    RDLABL2B       NO, GO LOOK AT LABEL             @V407466 00244000
         L     R1,IOBCSW      ADDR LAST CCW EXECUTED           @V407466 00245000
         LA    R1,0(,R1)      CLEAR HI-ORDER GARBAGE           @V407466 00246000
         CR    R5,R1          DID WE CYL FAULT?                @V407466 00247000
         BE    RDLABL2B       NO CYL FAULT SITUATION           @V407466 00248000
         MVC   RDEVSER(6),BLANKS BLANK VOLID IN RDEVBLOK       @V407466 00249000
         B     RDLFRET        RELEASE BLOCKS                   @V407466 00250000
RDLABL2B C     R2,F1          READING ALLOCATION RECORD ?      @V407466 00251000
         BE    EXIT2          YES - JUST RETURN FOR NOW        @V407466 00252000
         USING VDELOK,R10     SWITCH DSECTS                    @V407466 00253000
         CLI   RDEVTYPE,TYP3340 3340 TYPE                      @V407466 00254000
         BNE   RDLABL3        NO - BRANCH                      @V407466 00255000
         NI    RDEVFTR,X'FF'-(FTRRPS+FTR35MB+FTR70MB) RESET    @V407466 00256000
         TM    VDELSNS+2,X'80' RPS FEATURE INSTALLED ?         @V407466 00257000
         BZ    *+8            NO -                             @V407466 00258000
         OI    RDEVFTR,FTRRPS INDICATE RPS INSTALLED           @V407466 00259000
         TM    VDELSNS+2,X'03' 35MB OR 70MB MODULE MOUNTED?    @V407466 00260000
         BNM   DATMODER       DATA MODULE TYPE ERROR           @V407466 00261000
         TM    VDELSNS+2,X'02' 3340 70MB PACK MOUNTED ?        @V407466 00262000
         BZ    SET35MB        NO -  MUST BE 35MB PACK          @V407466 00263000
         OI    RDEVFTR,FTR70MB INDICATE 70MB PACK MOUNTED      @V407466 00264000
         B     RDLABL3        ..                               @V407466 00265000
SET35MB  OI    RDEVFTR,FTR35MB INDICATE 35MB PACK MOUNTED      @V407466 00266000
RDLABL3  EQU   *              INTERPRET LABEL RECORD           @V407466 00267000
         LA    R14,VDELBUF+4  POINT TO STD LABEL SERIAL START  @V407466 00268000
         CLC   VDELBUF(4),=C'VOL1' IS IT STANDARD FORMAT ?     @V407466 00269000
         BNE   RDLBCMS        NO - CHECK FOR CMS LABEL         @V407466 00270000
         CLC   VDELBUF+46(5),=C'CP370' ALLOCATION DATA PRESENT?@V407466 00271000
         BNE   RDLABSR        NO - MOVE VOLID TO RDEVBLOK      @V407466 00272000
         LR    R7,R13         SAVE PTR TO VDE SAVEAREA         @V407466 00273000
         L     R13,SAVER13    PICK UP PTR TO VDA SAVEAREA      @V407466 00274000
         OI    SAVEWRK1+1,CPOWND CP/370 OWNED VOLUME FORMAT    @V407466 00275000
         LR    R13,R7         RESTORE VDE SAVEAREA ADDRESS     @V407466 00276000
         B     RDLABSR        MOVE VOLID TO RDEVBLOK           @V407466 00277000
RDLBCMS  EQU   *              SEE IF RECOGNIZABLE LABEL FORMAT @V407466 00278000
         CLC   VDELBUF(4),=C'CMS=' CMS FORMAT ?                @V407466 00279000
         BE    RDLABSR        YES                              @V407466 00280000
         LA    R14,VDELBUF    NON-STANDARD LABEL START         @V407466 00281000
         SPACE                                                          00282000
RDLABSR  EQU   *              FILL IN RDEVBLOK SERIAL FIELD    @V407466 00283000
         MVC   RDEVSER(6),0(R14) ...                           @V407466 00284000
         EJECT                                                          00285000
RDLFRET  EQU   *              RELEASE IOBLOK                   @V407466 00286000
         USING IOBLOK,R10                                      @V407466 00287000
         L     R1,IOBIOER     SEE IF IOERBLOK TO RELEASE       @V407466 00288000
         LTR   R1,R1          IS THERE ONE?                    @V407466 00289000
         BZ    IOBONLY        NO, RELEASE IOBLOK ONLY          @V407466 00290000
         LA    R0,IOERSIZE    SIZE OF IOERBLOK                 @V407466 00291000
         AH    R0,IOEREXT     ...PLUS EXTENSION SIZE           @VA07361 00291100
         CALL  DMKFRET        RELEASE IOERBLOK                 @V407466 00292000
IOBONLY  LR    R1,R10         IOBLOK ADDRESS TO R1             @V407466 00293000
         DROP  R10                                             @V407466 00294000
         L     R10,IOBMISC-IOBLOK(,R1) ATTACHEE'S VMBLOK       @V407466 00295000
         LA    R0,IOBSIZE     SIZE OF REGL. IOBLOK             @V407466 00296000
         CLI   RDEVTYPC,CLASDASD DASD DEVICE                   @V407466 00297000
         BNE   RDFRIOB        NO, IOBSIZE IS OK                @V407466 00298000
         LA    R0,VDELLEN     BLOCK SIZE                       @V407466 00299000
         C     R2,F1          ...EXCEPT THAT THE ALLOCATION    @V407466 00300000
         BNE   RDFRIOB        ...RECORD IS MUCH BIGGER         @V407466 00301000
         LA    R0,IOBSIZE+ALLOLEN                              @V407466 00302000
RDFRIOB  EQU   *              RELEASE THE IOBLOCK              @V407466 00303000
         CALL  DMKFRET        RELEASE IT...                    @V407466 00304000
EXIT     ST    R3,SAVER2      SAVE BAD RETURN CODE OR ZERO     @V407466 00305000
         EXIT              RETURN TO DMKVDA                    @V407466 00306000
         SPACE                                                          00307000
EXIT2    ST    R10,SAVER10    SAVE IOBLOK ADDRESS              @V407466 00308000
* WHEN READING ALLOCATION RECORD                               @V407466 00309000
         B     EXIT           AND GO EXIT                      @V407466 00310000
         SPACE 2                                                        00311000
NOTREDY  EQU   68             'NOTREADY'                       @V407466 00312000
BADLABL  EQU   72             READ FAILED FOR DASD LABEL       @V407466 00313000
BADLABL2 EQU   76             READ FAILED FOR ALLOC. RECORD    @V407466 00314000
UNKNOWN  EQU   80             DEVICE DOES NOT EXIST            @V407466 00315000
         SPACE                                                          00316000
* BITS DEFINED IN VDABITS+1:                                            00317000
CPOWND   EQU   X'20'          ALLOCATION DATA PRESENT ON VOLUME@V407466 00318000
         SPACE                                                          00319000
LABLCCW  CCW   X'07',LABLCNT-LABLCCW,CC+SILI,6 SEEK            @V407466 00320000
         CCW   X'08',LABLSRCH-LABLCCW,CC+SILI,1 TIC            @V407466 00321000
         CCW   X'03',0,SILI,1 NOP                              @V407466 00322000
LABLSRCH CCW   X'31',LABLCNT-LABLCCW+2,CC+SILI,5 SEARCH        @V407466 00323000
         CCW   X'08',*-8-LABLCCW,CC,1 TIC                      @V407466 00324000
         CCW   X'06',LABLBUF-LABLCCW,CC+SILI,80 RD DATA        @V407466 00325000
         CCW   X'04',LABLSNS-LABLCCW,SILI,IOERSNSZ SENSE       @V407466 00326000
LABLEND  EQU   *              END OF CCWS                      @V407466 00327000
LABLCNT  DC    AL2(0,0,0,3*256) BB,CC,HH,RX                    @V407466 00328000
LABLSZ   EQU   *-LABLCCW      SIZE OF EXTENSION                @V407466 00329000
LABLBUF  DS    0D             LABEL BUFFER LOCATION            @V407466 00330000
         ORG   *+80                                            @V407466 00331000
LABLSNS  EQU   *                                               @V407466 00332000
         ORG   *-80                                            @V407466 00333000
         SPACE 3                                                        00334000
ALLOCNT  DC    AL2(0,0,0,4*256) BB,CC,HH,RX                    @V407466 00335000
ALLOLEN  EQU   1024/8+(LABLBUF-LABLCCW)/8 EXTRA SIZE FOR ALLOC @V407466 00336000
         SPACE 2                                                        00337000
         EJECT                                                          00338000
         LTORG                                                 @V407466 00339000
         EJECT                                                          00340000
         COPY  SAVE                                            @V407466 00341000
         EJECT                                                          00342000
         COPY  EQU                                             @V407466 00343000
         COPY  DEVTYPES                                        @V407466 00344000
         PSA                                                   @V407466 00345000
         COPY  RBLOKS                                          @V407466 00346000
         COPY  IOBLOKS                                         @V407466 00347000
         COPY  IOER                                            @V407466 00348000
VDELOK   DSECT ,              DSECT FOR EXPANDED IOBLOK        @V407466 00349000
         DS    (IOBSIZE)D                                      @V407466 00350000
VDELCCW  DS    7D                                              @V407466 00351000
*                             SEEK,TIC/NOP/SEARCH/TIC/READ/SENSE        00352000
VDELCNT  DS    1D             SEEK AND SEARCH ARGS             @V407466 00353000
VDELBUF  DS    10D            80-BYTE LABEL-RECORD BUFFER      @V407466 00354000
VDELSNS  DS    CL(IOERSNSZ)   SENSE AREA                       @V407466 00355000
VDELLEN  EQU   (*-VDELOK)/8   BLOCK LENGTH IN DBL-WDS          @V407466 00356000
         SPACE                                                          00357000
DMKVDE   CSECT ,              RE-ENTER MAIN CSECT              @V407466 00358000
         EJECT                                                          00359000
         END   DMKVDE                                                   00360000